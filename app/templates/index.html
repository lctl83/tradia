<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA DCI - Assistants linguistiques</title>
    <link rel="icon" type="image/jpeg" href="/static/logo-dci.jpg">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <img src="/static/logo-dci.jpg" alt="Logo DCI" class="logo">
            <p class="subtitle" id="headerSubtitle">Traduisez, reformulez et corrigez vos textes avec une IA interne DCI
                <span class="beta-badge">B√™ta</span>
            </p>
            <p class="data-notice">üîí Aucune donn√©e n'est envoy√©e √† l'ext√©rieur ou conserv√©e sur ce serveur.</p>
        </div>

        <form id="assistantForm">
            <div class="language-grid" id="languageSelectors">
                <div class="form-group">
                    <label for="source_lang">Langue source</label>
                    <select id="source_lang" name="source_lang" required>
                        {% for code, name in languages.items() %}
                        <option value="{{ code }}">{{ name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="target_lang">Langue cible</label>
                    <select id="target_lang" name="target_lang" required>
                        {% for code, name in languages.items() %}
                        <option value="{{ code }}" {% if code=='en' %}selected{% endif %}>{{ name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="model">Mod√®le Ollama</label>
                <select id="model" name="model">
                    <option value="{{ default_model }}">{{ default_model }}</option>
                </select>
            </div>

            <div class="tabs" role="tablist">
                <button type="button" class="tab-button active" data-tab="translation" aria-selected="true">üìù
                    Traduction</button>
                <button type="button" class="tab-button" data-tab="correction" aria-selected="false">‚úÖ Correction
                    orthographique</button>
                <button type="button" class="tab-button" data-tab="reformulation" aria-selected="false">‚ôªÔ∏è
                    Reformulation</button>
                <button type="button" class="tab-button" data-tab="summary" aria-selected="false">üóÇÔ∏è Compte
                    rendu</button>
                <button type="button" class="tab-button" data-tab="scenari" aria-selected="false">üìÑ Documents
                    SCENARI</button>
            </div>

            <div id="translationTab" class="tab-content active" role="tabpanel">
                <div class="dual-panel">
                    <div class="panel">
                        <label for="textInput">Texte √† traduire</label>
                        <textarea id="textInput" name="text" rows="10"
                            placeholder="Entrez le texte √† traduire..."></textarea>
                    </div>
                    <div class="panel">
                        <div class="panel-header">
                            <label for="translatedTextOutput">R√©sultat</label>
                            <button type="button" class="copy-btn" id="copyTranslationBtn">üìã Copier</button>
                        </div>
                        <textarea id="translatedTextOutput" rows="10" readonly></textarea>
                    </div>
                </div>
                <button type="submit" class="btn" id="translateSubmitBtn">‚ö° Traduire</button>
            </div>

            <div id="correctionTab" class="tab-content" role="tabpanel">
                <div class="dual-panel">
                    <div class="panel">
                        <label for="correctionInput">Texte √† corriger</label>
                        <textarea id="correctionInput" rows="10"
                            placeholder="Collez votre texte √† corriger..."></textarea>
                    </div>
                    <div class="panel">
                        <div class="panel-header">
                            <label>Texte corrig√© (diff√©rences surlign√©es)</label>
                            <button type="button" class="copy-btn" id="copyCorrectionBtn">üìã Copier</button>
                        </div>
                        <div id="correctionDiff" class="diff-output"></div>
                        <textarea id="correctionOutput" style="display:none;"></textarea>
                    </div>
                </div>
                <div class="explanations" id="correctionExplanations">
                    <h3>Explications des corrections</h3>
                    <ul id="correctionExplanationList"></ul>
                </div>
                <button type="submit" class="btn" id="correctionSubmitBtn">‚úÖ Corriger</button>
            </div>

            <div id="reformulationTab" class="tab-content" role="tabpanel">
                <div class="dual-panel">
                    <div class="panel">
                        <label for="reformulationInput">Texte √† reformuler</label>
                        <textarea id="reformulationInput" rows="10"
                            placeholder="Collez votre texte √† reformuler..."></textarea>
                    </div>
                    <div class="panel">
                        <div class="panel-header">
                            <label for="reformulationOutput">Texte reformul√©</label>
                            <button type="button" class="copy-btn" id="copyReformulationBtn">üìã Copier</button>
                        </div>
                        <textarea id="reformulationOutput" rows="10" readonly></textarea>
                    </div>
                </div>
                <div class="explanations" id="reformulationHighlights">
                    <h3>Mise en avant des modifications</h3>
                    <ul id="reformulationHighlightList"></ul>
                </div>
                <button type="submit" class="btn" id="reformulationSubmitBtn">‚ôªÔ∏è Reformuler</button>
            </div>

            <div id="summaryTab" class="tab-content" role="tabpanel">
                <div class="dual-panel">
                    <div class="panel">
                        <label for="summaryInput">Notes de r√©union</label>
                        <textarea id="summaryInput" rows="8" placeholder="Collez vos notes de r√©union..."></textarea>

                        <div class="upload-or-text">ou importez une photo</div>

                        <div class="image-upload-zone" id="imageUploadZone">
                            <div class="image-upload-icon">üì∑</div>
                            <div class="image-upload-text">
                                <strong>Cliquez</strong> ou glissez-d√©posez une image<br>
                                <small>(photo de notes manuscrites, tableau blanc, etc.)</small>
                            </div>
                            <input type="file" id="summaryImageInput" accept="image/*" style="display: none;">
                            <div class="image-preview-container" id="imagePreviewContainer">
                                <img id="imagePreview" class="image-preview" alt="Pr√©visualisation">
                                <button type="button" class="image-clear-btn" id="imageClearBtn"
                                    title="Supprimer l'image">‚úï</button>
                            </div>
                        </div>
                    </div>
                    <div class="panel">
                        <div class="panel-header">
                            <label for="summaryOutput">Compte rendu g√©n√©r√©</label>
                            <button type="button" class="copy-btn" id="copySummaryBtn">üìã Copier</button>
                        </div>
                        <textarea id="summaryOutput" rows="10" readonly></textarea>
                    </div>
                </div>
                <div class="summary-sections">
                    <div class="summary-section">
                        <h4>D√©cisions</h4>
                        <ul id="summaryDecisions"></ul>
                    </div>
                    <div class="summary-section">
                        <h4>Actions √† mener</h4>
                        <ul id="summaryActions"></ul>
                    </div>
                </div>
                <button type="submit" class="btn" id="summarySubmitBtn">üóÇÔ∏è G√©n√©rer le compte rendu</button>
            </div>

            <div id="scenariTab" class="tab-content" role="tabpanel">
                <div class="scenari-upload-section">
                    <div class="scenari-upload-zone" id="scenariUploadZone">
                        <div class="scenari-upload-icon">üìÅ</div>
                        <div class="scenari-upload-text">
                            <strong>Glissez vos fichiers XML SCENARI ici</strong><br>
                            <small>ou cliquez pour s√©lectionner (plusieurs fichiers accept√©s)</small>
                        </div>
                        <input type="file" id="scenariFilesInput" accept=".xml" multiple style="display: none;">
                    </div>

                    <div class="scenari-files-list" id="scenariFilesList"></div>

                    <div class="scenari-preview" id="scenariPreview" style="display: none;">
                        <span class="scenari-preview-count">
                            <strong id="scenariTotalElements">0</strong> √©l√©ments √† traduire
                        </span>
                    </div>
                </div>

                <div class="language-grid scenari-languages">
                    <div class="form-group">
                        <label for="scenari_source_lang">Langue source</label>
                        <select id="scenari_source_lang" name="scenari_source_lang">
                            {% for code, name in languages.items() %}
                            <option value="{{ code }}">{{ name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="scenari_target_lang">Langue cible</label>
                        <select id="scenari_target_lang" name="scenari_target_lang">
                            {% for code, name in languages.items() %}
                            <option value="{{ code }}" {% if code=='en' %}selected{% endif %}>{{ name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="scenari-progress" id="scenariProgress" style="display: none;">
                    <div class="scenari-progress-header">
                        <span id="scenariProgressFile">Fichier 1/1</span>
                        <span id="scenariProgressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-bar-fill" id="scenariProgressBar"></div>
                    </div>
                    <div class="scenari-progress-detail" id="scenariProgressDetail">
                        Pr√©paration...
                    </div>
                </div>

                <div class="scenari-actions">
                    <button type="submit" class="btn" id="scenariSubmitBtn" disabled>‚ö° Traduire les fichiers</button>
                    <button type="button" class="btn btn-secondary" id="scenariDownloadBtn" style="display: none;">
                        üì• T√©l√©charger
                    </button>
                </div>
            </div>
        </form>

        <div class="progress" id="progress">
            <div class="progress-bar">
                <div class="progress-bar-fill"></div>
            </div>
            <div class="progress-text" id="progressText">Traitement en cours...</div>
        </div>

        <div class="error" id="error">
            <div class="error-text" id="errorText"></div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
    <script>
        // Initialisation avec les donn√©es Jinja2
        initApp({
            rtlLanguages: {{ rtl_languages | tojson }},
            defaultModel: "{{ default_model }}"
        });
    </script>
</body>

</html>